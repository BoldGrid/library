language: php

# Distrubution / environments: https://docs.travis-ci.com/user/reference/overview/
# Ubuntu Trusty does not support php8: https://docs.travis-ci.com/user/languages/php/
dist: focal

services:
  # Specifically including MySQL was not needed with Trusty, but other environments do need it.
  - mysql

notifications:
  email:
    on_success: never
    on_failure: change

language: node_js
node_js:
  - "8.12.0"

env:
  - WP_VERSION=latest WP_MULTISITE=0

matrix:
  include:
    - php: 7.4
      before_script:
        # Yarn will not install any package listed in devDependencies if the NODE_ENV environment variable is set to production.
        - yarn install --production=false
        # Remove phpunit and install best phpunit version based on this environment.
        - composer remove --dev phpunit/phpunit && composer require --dev phpunit/phpunit
        - composer install -o
        - bash bin/install-wp-tests.sh wordpress_test root '' localhost $WP_VERSION
    - php: 8.0
      before_script:
        # Yarn will not install any package listed in devDependencies if the NODE_ENV environment variable is set to production.
        - yarn install --production=false
        # Remove phpunit and install best phpunit version based on this environment.
        - composer remove --dev phpunit/phpunit && composer require --dev phpunit/phpunit
        - composer install -o
        - bash bin/install-wp-tests.sh wordpress_test root '' localhost $WP_VERSION


script:
  - vendor/phpunit/phpunit/phpunit --debug
  - ls -alh $HOME/.cache/yarn
  - locate node_modules
  - yarn run js-lint
